// vim: ft=groovy et ts=2 sw=2:

node('ansible') {
    ansiColor('xterm') {
      stage("Warming up") {
        container('ansible') {
          // Checking out public repo
          checkout scm
          // Loading library
          commonCode = load "${env.WORKSPACE}/application/pipelines/commonGroovy/common.groovy"
        }
      }
      stage("Slack")
      {
          slackSend channel: '#test-alerts', 
                          message: 'Hello, world'
          
          
      }
      stage("Test") {
          container('newman'){
            sh """
                  npm install -g newman-reporter-htmlextra
                  newman run https://www.getpostman.com/collections/46d50cdb62091c2e5e9d -e ${env.WORKSPACE}/application/pipelines/deploy/newman/environment.json -r htmlextra --reporter-htmlextra-export ${env.WORKSPACE}/newman.html         
               """
               archiveArtifacts "newman.html"
          }          
        } 
      }
    }


